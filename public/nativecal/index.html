<!-- 
Open sourced under the MIT License: https://opensource.org/licenses/MIT
Copyright (c) 2025 Kalid Azad
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML Meta Tags -->
    <title>PasteCal: Shareable, no-login calendar</title>
    <meta name="description" content="Create a public shared calendar link, no signups needed.">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://pastecal.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="PasteCal: Shareable, no-login calendar">
    <meta property="og:description" content="Create a public shared calendar link, no signups needed.">
    <meta property="og:image" content="https://pastecal.com/img/screenshot.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="pastecal.com">
    <meta property="twitter:url" content="https://pastecal.com/">
    <meta name="twitter:title" content="PasteCal: Shareable, no-login calendar">
    <meta name="twitter:description" content="Create a public shared calendar link, no signups needed.">
    <meta name="twitter:image" content="https://pastecal.com/img/screenshot.png">

    <!-- Favicons: https://realfavicongenerator.net/ -->
    <link rel="icon" type="image/png" href="/img/icons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/img/icons/favicon.svg" />
    <link rel="shortcut icon" href="/img/icons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Preconnects for faster third-party fetches -->
    <link rel="preconnect" href="https://cdn.syncfusion.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            const enableAnalytics = !(w.__TEST__ || w.location.search.includes('no-analytics'));
            if (!enableAnalytics) {
                console.log('[analytics] disabled by test mode');
                return;
            }
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WTP9VTM');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Core styles -->
    <link rel="stylesheet" href="/style.css?v=1763769217">
    <link rel="stylesheet" href="/nativecal/native.css">

    <!-- Third-party libraries -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chrono-node@1.4.9/dist/chrono.min.js"></script>
    
    <script>
        window.CAL_BASE = '/nativecal';
    </script>

    <!-- Firebase config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCZ9U1FflAFcdDLgxJscs2BwV_PrXqmzKw",
            authDomain: "pastecal-web.firebaseapp.com",
            databaseURL: "https://pastecal-web-default-rtdb.firebaseio.com",
            projectId: "pastecal-web",
            storageBucket: "pastecal-web.appspot.com",
            messagingSenderId: "912998627577",
            appId: "1:912998627577:web:aa652846c2618a986d8a28",
            measurementId: "G-4J99GY9KE6"
        };
        firebase.initializeApp(firebaseConfig);

        if (location.href.includes("localhost") && location.href.includes("?local")) {
            firebase.functions().useEmulator("localhost", 5001);
        }
    </script>

    <!-- App scripts (order matters: Utils → models/services → directives → components) -->
    <script src="/utils/utils.js?v=1763769217"></script>
    <script src="/models/Event.js?v=1763769217"></script>
    <script src="/services/SlugManager.js?v=1763769217"></script>
    <script src="/services/CalendarDataService.js?v=1763769217"></script>
    <script src="/models/Calendar.js?v=1763769217"></script>
    <script src="/directives/clickOutside.js?v=1763769217"></script>
    <!-- Components -->
    <!-- NativeCalendar.js loaded by loader.js -->
    <script src="/components/icons.js?v=1763769217"></script>
    <script src="/components/ToastNotification.js?v=1763769217"></script>
    <script src="/components/QuickAddButton.js?v=1763769217"></script>
    <script src="/components/Tooltip.js?v=1763769217"></script>
    <script src="/components/QuickAddDialog.js?v=1763769217"></script>
    <script src="/components/CalendarTitle.js?v=1763769217"></script>
    <script src="/components/NavigationDropdown.js?v=1763769217"></script>

    <script>
        // Load-order guard for critical globals
        (function () {
            const required = [
                ['Utils', () => typeof Utils !== 'undefined'],
                ['Event', () => typeof Event !== 'undefined'],
                ['Calendar', () => typeof Calendar !== 'undefined'],
                ['SlugManager', () => typeof SlugManager !== 'undefined'],
                ['CalendarDataService', () => typeof CalendarDataService !== 'undefined'],
                ['QuickAddButton', () => typeof QuickAddButton !== 'undefined'],
                ['QuickAddDialog', () => typeof QuickAddDialog !== 'undefined'],
                ['ToastNotification', () => typeof ToastNotification !== 'undefined'],
                ['Tooltip', () => typeof Tooltip !== 'undefined'],
            ];

            const missing = required.filter(([, check]) => !check()).map(([name]) => name);
            if (missing.length) {
                console.error('[load-order] Missing globals:', missing.join(', '));
            }
        })();
    </script>

    <!-- Self-test suite (only loads on localhost) -->
    <script>
        if (window.location.hostname.match(/^(localhost|127\.0\.0\.1|::1)$/)) {
            const script = document.createElement('script');
            script.src = '/selftest.js?v=1763769217';
            document.head.appendChild(script);
        }
    </script>

</head>

<body class="p-1 m-1">
    <div id="app" data-testid="app-root">
        <!-- Mobile Header -->
        <div class="md:hidden flex flex-col mb-2 pt-3 space-y-3" data-testid="mobile-header">
            <!-- Row 1: Logo, Title, Menu -->
            <div class="relative flex items-center justify-between gap-2">
                <!-- Logo & Recents -->
                <div class="relative z-40 flex-shrink-0" v-click-outside="closeRecents">
                    <div @click.stop="toggleRecents" class="cursor-pointer flex items-center gap-1">
                        <div class="flex items-center gap-1.5">
                            <img class="h-8 w-8 dark:brightness-150" src="/img/pastecal.logo.svg" alt="PasteCal Logo">
                            <span
                                class="text-sm font-medium text-blue-500 hover:text-blue-600 transition-colors">pastecal</span>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 text-color-1" fill="currentColor"
                            viewBox="0 0 16 16" aria-label="Recent calendars">
                            <path fill-rule="evenodd"
                                d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                        </svg>
                    </div>
                    <navigation-dropdown v-if="showRecents" :recent-calendars="recentCalendars"
                        @go-homepage="goToHomepage" @toggle-pin="togglePin" @remove-recent="removeRecent"
                        class="mt-2"></navigation-dropdown>
                </div>

                <!-- Center: Title (absolutely centered) -->
                <div class="absolute left-1/2 transform -translate-x-1/2 z-30 flex items-center gap-1">
                    <calendar-title :title="calendar.title" :is-editing="editTitle" :is-read-only="isReadOnly"
                        mode="mobile" input-ref="mobileTitleInput" class="overflow-hidden max-w-[120px]"
                        @update:title="calendar.title = $event" @click="editTitle = true" @blur="editTitle = false"
                        @enter="editTitle = false">
                    </calendar-title>
                    <button v-if="!editTitle" v-on:click="toggleNotes" aria-label="Toggle notes"
                        class="text-color-1 hover:text-blue-500 p-1 transition-colors flex items-center justify-center flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                        </svg>
                    </button>
                </div>

                <!-- Right Actions: Share + Menu -->
                <div class="flex items-center gap-1 text-color-1 flex-shrink-0">
                    <!-- Share button -->
                    <button v-if="isExisting" @click="toggleShare()" aria-label="Share calendar"
                        data-testid="share-button-mobile"
                        class="p-1 hover:text-blue-500">
                        <icon name="share" class="w-5 h-5"></icon>
                    </button>
                    <!-- Kebab Menu (...) -->
                    <div class="relative z-40">
                        <button @click.stop="showMobileMenu = !showMobileMenu" aria-label="Open menu"
                            class="p-1 hover:text-blue-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
                            </svg>
                        </button>
                        <!-- Dropdown -->
                        <div v-if="showMobileMenu" v-click-outside="() => showMobileMenu = false"
                            class="absolute right-0 top-full mt-2 w-48 bg-1 rounded-lg shadow-xl border border-color-default py-1 text-sm text-color-2 z-50">
                        <button @click="showMobileMenu = false; toggleSearch()"
                                data-testid="search-button-mobile"
                                class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2">
                                                                        <icon name="search" class="w-5 h-5"></icon>                                Search
                            </button>
                            <button
                                @click="showMobileMenu = false; $refs.quickAddDialog && $refs.quickAddDialog.showDialog()"
                                class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2">
                                <span class="text-lg leading-none font-bold text-blue-500">+</span> Quick Add Event
                            </button>
                                                            <button @click="showMobileMenu = false; toggleSettings()"
                                                                    data-testid="settings-button-mobile"
                                                                    class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2">
                                                                    <icon name="settings" class="w-5 h-5"></icon>
                                                                    Settings
                                                                </button>                            <button @click="showMobileMenu = false; toggleHelp()"
                                class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                                </svg>
                                Help
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 2: Claim URL (only for new calendars) -->
            <div v-show="!isExisting"
                class="flex items-center bg-1 border border-color-default rounded-lg p-2 shadow-sm">
                <span class="text-color-1 text-sm pl-1 pr-1 font-medium" id="url-prefix-mobile">pastecal.com/</span>
                <input type="text" v-model="calendar.id" @input="handleSlugInput" @keyup.enter="create"
                    class="flex-1 bg-transparent border-none focus:ring-0 p-1 text-sm font-bold text-color-2 min-w-0"
                    placeholder="your-link" aria-label="Custom URL slug" aria-describedby="url-prefix-mobile">
                <button @click="create"
                    class="bg-blue-600 text-white text-sm font-bold px-4 py-1.5 rounded-md shadow-sm whitespace-nowrap"
                    aria-label="Claim calendar URL">
                    Claim
                </button>
            </div>
        </div> <!-- Closing div for md:hidden -->

        <!-- Mobile FAB removed - mobile menu will open the central quick-add dialog directly -->

        <!-- Single dialog instance used by button triggers -->
        <quick-add-dialog ref="quickAddDialog" @event-created="handleQuickAddEvent"></quick-add-dialog>

        <topbar class="hidden md:flex justify-between items-center pb-1 md:pb-3 text-sm">
            <!-- Left section -->
            <section class="flex-1 flex flex-col md:flex-row items-start md:space-x-2 min-w-0">
                <!-- Logo and app name -->
                <logo class="flex items-center text-sm h-8 relative">
                    <div class="relative" v-click-outside="closeRecents" @mouseenter="handleDropdownMouseEnter"
                        @mouseleave="handleDropdownMouseLeave">
                        <div class="flex items-center space-x-2">
                            <a @click.prevent="toggleRecents" class="flex items-center group cursor-pointer">
                                <img class="h-8 w-8 mr-1.5 flex-shrink-0 dark:brightness-150"
                                    src="/img/pastecal.logo.svg" alt="PasteCal Logo">
                                <div class="flex flex-col">
                                    <span
                                        class="text-blue-500 font-medium text-sm hover:text-blue-600 transition-colors">pastecal</span>
                                    <span class="text-color-1 hidden lg:block -mt-0.5 text-[10px]">no-login
                                        shared calendar</span>
                                </div>
                            </a>

                            <!-- Dropdown arrow indicator -->
                            <button @click.stop="toggleRecents"
                                class="text-color-1 hover:text-blue-500 p-1 transition-colors" title="Recent calendars">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="currentColor"
                                    viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                </svg>
                            </button>
                        </div>

                        <!-- Navigation dropdown component -->
                        <navigation-dropdown v-if="showRecents" :recent-calendars="recentCalendars"
                            @go-homepage="goToHomepage" @toggle-pin="togglePin" @remove-recent="removeRecent" v-cloak>
                        </navigation-dropdown>
                    </div>
                </logo>

                <!-- Action buttons -->
                <buttonarea class="flex items-center space-x-1 mt-0">

                    <!-- Help button -->
                    <custom-tooltip width="w-auto" align="center">
                        <template #trigger>
                            <button v-on:click="toggleHelp" aria-label="Show help"
                                class="text-color-1 hover:text-blue-500 p-1.5 rounded-full transition-colors flex items-center justify-center h-8">
                                <icon name="help" class="w-5 h-5"></icon>
                            </button>
                        </template>
                        <template #content>
                            <span class="whitespace-nowrap">Show Help</span>
                        </template>
                    </custom-tooltip>

                    <!-- Search button -->
                    <custom-tooltip width="w-auto" align="center">
                        <template #trigger>
                            <button v-on:click="toggleSearch" aria-label="Search events"
                                data-testid="search-button-desktop"
                                class="text-color-1 hover:text-blue-500 p-1.5 rounded-full transition-colors">
                                <icon name="search" class="w-5 h-5"></icon>
                            </button>
                        </template>
                        <template #content>
                            <span class="whitespace-nowrap">Search Events</span>
                        </template>
                    </custom-tooltip>

                    <!-- Settings button -->
                    <custom-tooltip width="w-auto" align="center">
                        <template #trigger>
                            <button v-on:click="toggleSettings" aria-label="Settings"
                                data-testid="settings-button-desktop"
                                class="text-color-1 hover:text-blue-500 p-1.5 rounded-full transition-colors flex items-center justify-center h-8">
                                <icon name="settings" class="w-5 h-5"></icon>
                            </button>
                        </template>
                        <template #content>
                            <span class="whitespace-nowrap">Settings</span>
                        </template>
                    </custom-tooltip>

                    <!-- Quick add button - desktop only -->
                    <quick-add-button v-if="canEdit" class="block"
                        @open="$refs.quickAddDialog && $refs.quickAddDialog.showDialog()"
                        aria-label="Quick add event"></quick-add-button>

                </buttonarea>
            </section>

            <!-- Middle section - Calendar title -->
            <section
                class="hidden md:flex flex-1 flex-col md:flex-row items-center justify-center mx-1 md:mx-2 min-w-0 min-h-8"
                data-testid="desktop-title-area"
                v-cloak v-if="!isLoading">
                <custom-tooltip width="w-auto" align="center" v-if="!editTitle && !isReadOnly">
                    <template #trigger>
                        <calendar-title :title="calendar.title" :is-editing="editTitle" :is-read-only="isReadOnly"
                            mode="desktop" input-ref="desktopTitleInput" @update:title="calendar.title = $event"
                            @click="editTitle = true" @blur="editTitle = false" @enter="setTitle($event)">
                        </calendar-title>
                    </template>
                    <template #content>
                        <span class="whitespace-nowrap">Click to edit title</span>
                    </template>
                </custom-tooltip>
                <calendar-title v-if="!editTitle && isReadOnly" :title="calendar.title" :is-editing="editTitle"
                    :is-read-only="isReadOnly" mode="desktop" @update:title="calendar.title = $event"
                    @click="editTitle = true" @blur="editTitle = false" @enter="setTitle($event)">
                </calendar-title>
                <calendar-title v-if="editTitle" :title="calendar.title" :is-editing="editTitle"
                    :is-read-only="isReadOnly" mode="desktop" input-ref="desktopTitleInput"
                    @update:title="calendar.title = $event" @click="editTitle = true" @blur="editTitle = false"
                    @enter="setTitle($event)">
                </calendar-title>
                <custom-tooltip width="w-auto" align="center" v-if="!editTitle">
                    <template #trigger>
                        <button v-on:click="toggleNotes" aria-label="Toggle notes"
                            class="text-color-1 hover:text-blue-500 p-1.5 rounded-full transition-colors flex items-center justify-center h-8">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                                </svg>
                                <span class="ml-0.5 text-xs hidden lg:inline">Notes</span>
                            </div>
                        </button>
                    </template>
                    <template #content>
                        <span class="whitespace-nowrap">Toggle Notes</span>
                    </template>
                </custom-tooltip>
            </section>

            <!-- Right section -->
            <section class="flex-1 flex items-center justify-end text-xs min-w-0 h-8" v-cloak>

                <!-- Loading state -->
                <div v-if="isLoading">
                    <div
                        class="flex items-center bg-1 border border-color-default rounded-full p-1 pl-3 pr-3 shadow-sm select-none">
                        <!-- Share Icon -->
                        <div class="text-color-1 flex-shrink-0 mr-1.5">
                            <icon name="share" class="w-5 h-5"></icon>
                        </div>
                        <!-- Text -->
                        <div class="text-color-1 text-xs">
                            Loading...
                        </div>
                    </div>
                </div>

                <div v-if="!isLoading && isReadOnly">
                    <custom-tooltip align="right">
                        <template #trigger>
                            <div class="flex items-center bg-1 border border-color-default rounded-full p-1 pl-3 pr-3 shadow-sm cursor-pointer select-none hover:border-blue-500 hover:bg-[var(--bg-interactive-hover)] transition-all"
                                @click="toggleShare"
                                data-testid="share-pill-readonly">
                                <!-- Share Icon -->
                                <div class="text-color-1 flex-shrink-0 mr-1.5">
                                    <icon name="share" class="w-5 h-5"></icon>
                                </div>
                                <!-- Text -->
                                <div class="text-color-2 text-xs font-bold">
                                    View Only
                                </div>
                            </div>
                        </template>
                        <template #content>
                            <p class="leading-relaxed">
                                You are in View Only mode. Events cannot be added or edited.
                            </p>
                        </template>
                    </custom-tooltip>
                </div>

                <div v-if="!isLoading && !isReadOnly">
                    <!-- Existing calendar info -->
                    <div v-show="isExisting">
                        <custom-tooltip align="right">
                            <template #trigger>
                                <div class="relative flex items-center bg-1 border border-color-default rounded-full p-1 pl-3 pr-3 shadow-sm hover:border-blue-500 hover:bg-[var(--bg-interactive-hover)] cursor-pointer transition-all group select-none"
                                    @click="toggleShare"
                                    data-testid="share-pill-existing">

                                    <!-- Icon -->
                                    <div
                                        class="text-color-1 group-hover:text-blue-500 transition-colors flex-shrink-0 p-1 rounded-full mr-1">
                                        <icon name="share" class="w-5 h-5"></icon>
                                    </div>

                                    <!-- URL Text -->
                                    <div class="text-color-1 text-xs truncate max-w-[150px] md:max-w-xs">
                                        pastecal.com/<span class="font-bold text-color-2" v-text="calendar.id"></span>
                                    </div>
                                </div>
                            </template>
                            <template #content>
                                <p class="leading-relaxed">
                                    Get links to share with anyone or sync to your phone.
                                </p>
                            </template>
                        </custom-tooltip>
                    </div>

                    <!-- New calendar creation -->
                    <div v-show="!isExisting" class="flex flex-wrap md:flex-nowrap items-center gap-2 relative">

                        <custom-tooltip>
                            <template #trigger>
                                <!-- Unified Pill Container -->
                                <div
                                    class="flex items-center bg-1 border border-color-default rounded-full p-0 sm:p-1 pl-1.5 sm:pl-3 pr-0 sm:pr-1 shadow-sm focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all max-w-full relative">

                                    <!-- Domain -->
                                    <span
                                        class="text-color-1 text-sm font-medium hidden md:inline flex-shrink-0 tracking-tight">pastecal.com/</span>
                                    <span class="text-color-1 text-sm font-medium md:hidden flex-shrink-0">/</span>

                                    <!-- Input -->
                                    <input id="slug"
                                        class="bg-transparent border-none focus:ring-0 p-0 text-sm font-bold text-color-2 w-24 md:w-40 focus:outline-none placeholder-gray-400 min-w-0"
                                        type="text" :disabled="isExisting" v-model="calendar.id" @keyup.enter="create"
                                        @input="handleSlugInput" placeholder="your-name">

                                    <!-- Claim Button (Integrated) -->
                                    <button @click="create"
                                        class="ml-0.5 sm:ml-1 px-2 sm:px-3 py-1 sm:py-1.5 text-white bg-blue-600 font-bold rounded-full text-xs hover:bg-blue-700 transition-colors flex-shrink-0 shadow-sm">
                                        <span class="hidden sm:inline">Claim URL</span>
                                        <span class="inline sm:hidden">Claim</span>
                                    </button>
                                </div>
                            </template>
                            <template #content>
                                <p class="leading-relaxed">
                                    Claim any URL, like `/trip-2025`. Everyone with the URL can edit events. Use a
                                    random ID for privacy.
                                </p>
                            </template>
                        </custom-tooltip>
                    </div>
                </div>
            </section>
        </topbar>

        <panel class="flex bg-1 p-1 md:p-3 rounded-sm border border-color-default mb-4 relative w-full"
            v-if="isPanelOpen()" v-cloak>
            <button id="closeAllPanels"
                class="absolute top-0 right-0 m-2 md:m-4 text-color-1 hover:text-red-500 transition-colors"
                @click="closeAllPanels">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div v-if="showNotes" class="flex-1 w-full md:w-1/2 md:min-w-[460px] h-[250px] mx-auto p-2.5" v-cloak>
                <textarea v-if="canEdit" aria-label="Calendar notes"
                    class="w-full h-full p-2 border border-color-default rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                    placeholder="Notes..." v-model="calendar.options.notes"></textarea>

                <div v-if="isReadOnly"
                    class="w-full h-full p-2 border border-color-default rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                    v-html="getReadOnlyNotes()">
                </div>
            </div>
            <div v-if="showSearch" class="m-2 md:m-0 flex flex-col-reverse w-full md:w-1/2" v-cloak>

                <section class="flex-1 flex flex-col space-y-4">
                    <!-- Search Input -->
                    <div class="flex flex-col gap-2">
                        <input type="search" v-model="searchQuery" @input="searchEvents" aria-label="Search events"
                            class="w-full p-2 border border-color-default rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Search events...">
                    </div>

                    <!-- Search Results -->
                    <div v-if="searchResults.length > 0" class="max-h-64 overflow-auto">
                        <div v-for="event in searchResults" :key="event.id" @click="jumpToEvent(event)"
                            :style="{ borderLeft: '3px solid ' + getTypeColor(event.type) }"
                            class="cursor-pointer p-1 pl-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors mb-1">
                            <div class="font-semibold text-color-2">{{ event.title }}</div>
                            <div class="text-xs text-color-1">{{ formatDate(event.start) }} - {{
                                formatDate(event.end)}}</div>
                        </div>
                    </div>
                </section>

                <section class="flex-1 flex flex-col space-y-4 mb-2">

                    <!-- Filter Options -->
                    <div class="flex items-center space-x-2">
                        <span class="text-xs text-color-1">Show</span>
                        <div class="flex space-x-2">
                            <template v-for="(color, idx) in COLORS">
                                <span @click="toggleColorFilter(idx)"
                                    class="w-5 h-5 rounded-full cursor-pointer border-2 transition-all"
                                    :class="{'opacity-100 border-color-default': colorFilters[idx], 'opacity-25': !colorFilters[idx]}"
                                    :style="{ backgroundColor: color }">
                                </span>
                            </template>
                        </div>
                    </div>
                </section>
            </div>
            <div v-if="showHelp" class="text-sm text-color-2 p-4" v-cloak>
                <div class="w-full overflow-hidden rounded-lg">
                    <!-- Welcome Hero -->
                    <div class="mb-6 p-6 bg-2 rounded-lg border-l-4" style="border-color: var(--link);">
                        <h3 class="text-2xl font-bold mb-3" style="color: var(--link);">Shared calendars that just work.
                        </h3>
                        <p class="text-base mb-2">
                            No logins. No installs. Pick a link and start planning together.
                        </p>
                        <p>
                            Great for team schedules, clubs, vacation planning, and more. Everyone with the link
                            can edit in real time.
                        </p>
                    </div>

                    <!-- Feature Grid - 2x2 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                        <!-- Q1: How do I share -->
                        <div class="bg-2 rounded-lg p-4">
                            <div class="font-semibold flex items-center gap-2 mb-2">
                                <icon name="share" class="w-5 h-5" style="color: var(--link);"></icon>
                                How do I share a calendar?
                            </div>
                            <div class="text-sm text-color-1">
                                <p>Choose a URL like <code
                                        class="bg-disabled px-1.5 py-0.5 rounded text-xs">pastecal.com/summer-trip</code>
                                    -- that's it. Everyone with the link can view and edit. </p>
                            </div>
                        </div>

                        <!-- Q2: Privacy -->
                        <div class="bg-2 rounded-lg p-4">
                            <div class="font-semibold flex items-center gap-2 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" style="color: var(--link);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                Is this private?
                            </div>
                            <div class="text-sm text-color-1">
                                <p>Your calendar isn't listed anywhere, so only people with your calendar link can find
                                    it. For privacy, use a hard-to-guess name. Calendars also get a read-only link for
                                    public sharing.
                            </div>
                        </div>

                        <!-- Q3: Mobile -->
                        <div class="bg-2 rounded-lg p-4">
                            <div class="font-semibold flex items-center gap-2 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" style="color: var(--link);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                                Can I use this on my phone?
                            </div>
                            <div class="text-sm text-color-1">
                                <p>Yes, it works in any mobile browser. Want
                                    notifications and reminders? Add the ICS link to your phone's calendar app.
                                </p>
                            </div>
                        </div>

                        <!-- Q4: Switch calendars -->
                        <div class="bg-2 rounded-lg p-4">
                            <div class="font-semibold flex items-center gap-2 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" style="color: var(--link);">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                </svg>
                                How do I manage multiple calendars?
                            </div>
                            <p class="text-sm text-color-1">Hover over the <strong>PasteCal logo</strong>
                                to jump between your calendars. Make a few!</p>
                        </div>
                    </div>

                    <!-- Simple CTA -->
                    <div class="p-4 bg-2 rounded-lg text-center">
                        <p class="text-sm text-color-1">
                            <strong>Ready? Pick a name in the top right and save your new calendar.</strong>
                        </p>
                    </div>

                    <!-- Footer -->
                    <div class="mt-6 text-xs text-color-1 text-center space-y-1">
                        <p>
                            <a href="https://github.com/kazad/pastecal/issues" class="hover:underline"
                                style="color: var(--link);">
                                Share feedback/bugs on GitHub
                            </a>
                        </p>
                        <p>Made by Kalid (<a href="https://instacalc.com" class="hover:underline"
                                style="color: var(--link);">Instacalc</a>, <a href="https://betterexplained.com"
                                class="hover:underline" style="color: var(--link);">Better Explained</a>)</p>
                    </div>
                </div>
            </div>

            <div v-if="showShare" class="p-2.5 text-sm w-full" v-cloak>
                <h2 class="text-lg font-bold mb-4">Sharing & Security</h2>

                <!-- 2x2 Grid Layout -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Edit Access (Top Left) -->
                    <div v-if="canEdit" class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h4 class="font-medium mb-2 inline-flex items-center gap-x-2">

                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                            </svg>

                            Edit Access
                        </h4>
                        <p class="text-xs text-color-1 mb-3 italic">
                            Full editing access - anyone can view and change events
                        </p>
                        <div class="flex gap-2">
                            <input type="text" :value="getEditableURL()" readonly
                                class="flex-1 p-2 border border-color-default rounded bg-disabled text-sm">
                            <button @click="copyToClipboard(getEditableURL(), $event.currentTarget)"
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                <icon name="copy" class="h-4 w-4 mr-1"></icon>
                                <span>Copy</span>
                            </button>
                            <button v-if="canShare()" @click="shareUrl(getEditableURL(), 'Calendar')"
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!--  View Only (Top Right) -->
                    <div class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h4 class="font-medium mb-2 inline-flex items-center gap-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>

                            View Only
                        </h4>
                        <p class="text-xs text-color-1 mb-3 italic">
                            Read-only access - users can view but not edit events
                        </p>

                        <!-- View-only link (auto-created) -->
                        <div class="space-y-2">
                            <div class="flex gap-2">
                                <input type="text" :value="getReadOnlyURL()" readonly
                                    class="flex-1 p-2 border border-color-default rounded bg-disabled text-sm">
                                <button @click="copyToClipboard(getReadOnlyURL(), $event.currentTarget)"
                                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                    <icon name="copy" class="h-4 w-4 mr-1"></icon>
                                    <span>Copy</span>
                                </button>
                                <button v-if="canShare()" @click="shareUrl(getReadOnlyURL(), 'Calendar')"
                                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Short URL alias -->
                            <div class="text-xs text-color-1">
                                Short: pastecal.com/{{ getReadOnlySlug() }}
                            </div>

                            <!-- Customize existing link -->
                            <div class="">
                                <button @click="showReadOnlySlug = !showReadOnlySlug"
                                    class="text-xs text-blue-500 hover:text-blue-600">
                                    {{ showReadOnlySlug ? 'Cancel' : 'Customize URL' }}
                                </button>

                                <div v-if="showReadOnlySlug" class="mt-2">
                                    <div class="flex gap-2">
                                        <input type="text" v-model="readOnlySlugInput" placeholder="Enter custom name"
                                            class="flex-1 p-2 border border-color-default rounded bg-bg text-sm">
                                        <button @click="customizeExistingLink" :disabled="!readOnlySlugInput.trim()"
                                            class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400 text-xs">
                                            Update
                                        </button>
                                    </div>
                                    <div class="text-xs text-color-1 mt-1">
                                        New: pastecal.com/view/{{ readOnlySlugInput || 'custom-name' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Current View (Bottom Left) -->
                    <div class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h4 class="font-medium mb-2 inline-flex items-center gap-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />
                            </svg>

                            Current View
                        </h4>
                        <p class="text-xs text-color-1 mb-3 italic">
                            Share link to current date and view. Or add URL params: <code
                                class="bg-disabled px-1 py-0.5 rounded text-xs">?date=2024-04-01&view=week</code>
                        </p>
                        <div class="flex gap-2">
                            <input type="text" :value="currentViewURL" readonly
                                class="flex-1 p-2 border border-color-default rounded bg-disabled text-sm">
                            <button @click="copyToClipboard(currentViewURL, $event.currentTarget)"
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                <icon name="copy" class="h-4 w-4 mr-1"></icon>
                                <span>Copy</span>
                            </button>
                            <button v-if="canShare()" @click="shareUrl(currentViewURL, 'Calendar View')"
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Phone/Apps (Bottom Right) -->
                    <div class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h4 class="font-medium mb-2 inline-flex items-center gap-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                            </svg>


                            Phone/Apps
                        </h4>
                        <p class="text-xs text-color-1 mb-3 italic">
                            ICS link for other apps (phone calendar, Outlook, Google Calendar, etc.)
                        </p>

                        <!-- Edit ICS -->
                        <div class="space-y-3">
                            <div v-if="canEdit">
                                <div class="text-xs font-medium text-color-2 mb-1">Full Access:</div>
                                <div class="flex gap-2">
                                    <input type="text" :value="getEditableICSURL()" readonly
                                        class="flex-1 p-2 border border-color-default rounded bg-disabled text-sm">
                                    <button @click="copyToClipboard(getEditableICSURL(), $event.currentTarget)"
                                        class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                        <icon name="copy" class="h-4 w-4 mr-1"></icon>
                                        <span>Copy</span>
                                    </button>
                                </div>
                            </div>

                            <!-- View-Only ICS -->
                            <div v-if="getReadOnlyURL()">
                                <div class="text-xs font-medium text-color-2 mb-1">View Only:</div>
                                <div class="flex gap-2">
                                    <input type="text" :value="getReadOnlyICSURL()" readonly
                                        class="flex-1 p-2 border border-color-default rounded bg-disabled text-sm">
                                    <button @click="copyToClipboard(getReadOnlyICSURL(), $event.currentTarget)"
                                        class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center">
                                        <icon name="copy" class="h-4 w-4 mr-1"></icon>
                                        <span>Copy</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div v-if="showSettings" class="w-full p-2.5 text-sm text-color-2" v-cloak>
                <h2 class="text-lg font-bold mb-4">Settings</h2>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Global Settings -->
                    <div class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h3 class="font-bold text-color-2 mb-3">Personal Settings</h3>
                        <p class="text-xs text-color-1 mb-4 italic">Default settings for your device, when viewing any
                            calendar.
                        </p>

                        <div class="space-y-4">
                            <div>
                                <label class="block mb-1 font-medium">First day of week</label>
                                <select v-model="globalSettings.firstDayOfWeek" @change="saveGlobalSettings"
                                    class="w-full p-2 border border-color-default rounded ">
                                    <option value="0">Sunday</option>
                                    <option value="1">Monday</option>
                                </select>
                            </div>

                            <div>
                                <label class="block mb-1 font-medium">Time format</label>
                                <select v-model="globalSettings.timeFormat" @change="saveGlobalSettings"
                                    class="w-full p-2 border border-color-default rounded ">
                                    <option value="12">12-hour (1:00 PM)</option>
                                    <option value="24">24-hour (13:00)</option>
                                </select>
                            </div>

                            <div>
                                <label class="block mb-1 font-medium">Personal default view</label>
                                <select v-model="globalSettings.defaultView" @change="saveGlobalSettings"
                                    class="w-full p-2 border border-color-default rounded ">
                                    <option value="Day">Day</option>
                                    <option value="Week">Week</option>
                                    <option value="Month">Month</option>
                                    <option value="Custom">Custom ({{ personalCustomViewLabel }})</option>
                                    <option value="Year">Year</option>
                                    <option value="Agenda">Agenda</option>
                                </select>

                                <!-- Custom view configuration panel -->
                                <div v-if="globalSettings.defaultView === 'Custom'"
                                    class="mt-3 p-3 bg-color-panel border border-color-default rounded">
                                    <label class="block mb-2 text-sm font-medium">Custom view settings</label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" v-model.number="globalSettings.customViewDuration"
                                            @change="saveGlobalSettings" :min="1"
                                            :max="globalSettings.customViewUnit === 'Weeks' ? 52 : 24"
                                            class="w-20 p-2 border border-color-default rounded text-sm">
                                        <select v-model="globalSettings.customViewUnit" @change="saveGlobalSettings"
                                            class="flex-1 p-2 border border-color-default rounded text-sm">
                                            <option value="Weeks">Weeks</option>
                                            <option value="Months">Months</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block mb-1 font-medium">Start hour</label>
                                <select v-model="globalSettings.startHour" @change="saveGlobalSettings"
                                    class="w-full p-2 border border-color-default rounded ">
                                    <option value="00:00">12:00 AM</option>
                                    <option value="05:00">5:00 AM</option>
                                    <option value="06:00">6:00 AM</option>
                                    <option value="07:00">7:00 AM</option>
                                    <option value="08:00">8:00 AM</option>
                                    <option value="09:00">9:00 AM</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-color-2 mb-2">
                                    Theme
                                </label>
                                <div class="relative">
                                    <select v-model="globalSettings.darkMode" @change="saveGlobalSettings"
                                        class="appearance-none bg-1 border border-color-default text-color-2 rounded-lg px-4 py-2 pr-8 w-full focus:outline-none focus:ring-2 focus:ring-link focus:border-transparent">
                                        <option value="auto">🌓 Auto (System)</option>
                                        <option value="light">☀️ Light</option>
                                        <option value="dark">🌙 Dark</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                        <svg class="w-5 h-5 text-color-1" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calendar-specific Settings -->
                    <div class="bg-1 p-4 rounded-lg shadow-sm border border-color-default">
                        <h3 class="font-bold text-color-2 mb-3">Settings for '{{calendar.title}}' </h3>
                        <p class="text-xs text-color-1 mb-4 italic">Default settings for everyone viewing this calendar.
                        </p>

                        <div class="space-y-4">
                            <div class="relative">
                                <label class="block mb-1 font-medium">Event Colors &amp; Labels</label>
                                <p class="text-xs text-color-1 mb-2 italic">Click color circle or text to customize</p>

                                <button v-if="hasCustomColors" @click="resetAllColors"
                                    class="absolute right-0 top-0 text-xs text-link hover:text-link-hover">
                                    Reset colors
                                </button>

                                <div v-for="(label, index) in localSettings.typeLabels" :key="index"
                                    class="flex items-center mb-2">
                                    <div class="relative">
                                        <input type="color" :id="'color-picker-' + index"
                                            :value="localSettings.colors[index]"
                                            @change="updateEventColor(index, $event.target.value)"
                                            :aria-label="'Color picker for ' + (localSettings.typeLabels[index] || 'event type ' + (index + 1))"
                                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                                        <div class="w-5 h-5 rounded-full mr-2 cursor-pointer hover:ring-2 hover:ring-offset-1 hover:ring-link transition-all"
                                            :style="{backgroundColor: getTypeColor(index+1)}"></div>
                                    </div>
                                    <input :value="label" @input="updateTypeLabel(index+1, $event.target.value)"
                                        :aria-label="'Label for type ' + (index + 1)"
                                        class="flex-1 p-2 border border-color-default rounded text-sm"
                                        :placeholder="`Type ${index+1}`">
                                </div>
                            </div>

                            <!-- Default View -->
                            <div>
                                <label class="block mb-1 font-medium">Default view when calendar is opened</label>
                                <select v-model="calendar.options.defaultView"
                                    class=" w-1/3 p-2 border border-color-default rounded text-sm">
                                    <option :value="null">Auto ({{ calendarAutoViewLabel }})</option>
                                    <option value="Day">Day</option>
                                    <option value="Week">Week</option>
                                    <option value="Month">Month</option>
                                    <option value="Custom">Custom ({{ calendarCustomViewLabel }})</option>
                                    <option value="Year">Year</option>
                                    <option value="Agenda">Agenda</option>
                                </select>
                                <p class="mt-1 text-xs text-color-secondary italic">
                                    Auto allows the user's preference to load. Setting a default forces everyone to
                                    start on the same view.
                                </p>

                                <!-- Custom view configuration panel for calendar -->
                                <div v-if="calendar.options.defaultView === 'Custom'"
                                    class="mt-3 p-3 bg-color-panel border border-color-default rounded">
                                    <label class="block mb-2 text-sm font-medium">Custom view settings</label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" v-model.number="calendar.options.customViewDuration"
                                            :min="1" :max="calendar.options.customViewUnit === 'Weeks' ? 52 : 24"
                                            class="w-20 p-2 border border-color-default rounded text-sm">
                                        <select v-model="calendar.options.customViewUnit"
                                            class="flex-1 p-2 border border-color-default rounded text-sm">
                                            <option value="Weeks">Weeks</option>
                                            <option value="Months">Months</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block mb-1 font-medium">Display options</label>
                                <div class="flex items-center mt-2">
                                    <input type="checkbox" id="extendedHours" v-model="calendar.options.extended"
                                        class="mr-2">
                                    <label for="extendedHours">Show extended hours (12-4 AM)</label>
                                </div>
                            </div>

                            <!-- 
                                // Rename / Move (COMMENTED OUT FOR NOW)
                            <div v-if="isAutogeneratedId" class="pt-4 border-t border-color-default mt-4">
                                <h4 class="font-bold text-red-600 mb-2 text-xs uppercase tracking-wider">Danger Zone</h4>
                                
                                <div class="mb-1">
                                    <label class="block mb-1 font-medium text-xs text-color-2">Rename / Move Calendar</label>
                                    <p class="text-xs text-color-1 mb-2 italic">Copy this calendar's data to a new URL. The old URL will remain accessible.</p>
                                    <div class="flex gap-2">
                                        <input type="text" v-model="newCalendarId" placeholder="new-name" 
                                               class="flex-1 p-2 border border-color-default rounded text-sm"
                                               @keyup.enter="renameCalendar">
                                        <button @click="renameCalendar" 
                                                class="px-3 py-1 bg-red-50 text-red-600 border border-red-200 rounded text-xs hover:bg-red-100 transition-colors whitespace-nowrap">
                                            Move
                                        </button>
                                    </div>
                                </div>
                            </div>
                            -->
                        </div>
                    </div>
                </div>
            </div>
        </panel>

        <div id="cal2_wrap" style="width: 100%; height: 100%;" class="flex-1 overflow-hidden">
            <native-calendar
                :events="calendar.events"
                :time-format="globalSettings.timeFormat"
                @update:events="calendar.setEvents($event)"
            ></native-calendar>
        </div>

        <!-- Claim Intervention Modal -->
        <div v-if="showClaimDialog"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000]" v-cloak>
            <div class="bg-1 rounded-lg shadow-xl p-6 w-full max-w-md mx-4 relative">
                <button @click="showClaimDialog = false"
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                </button>

                <div class="text-center mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-2">Name your calendar</h3>
                    <p class="text-sm text-gray-600">
                        You're about to claim this permanent link.
                        <br>
                        Want to give it a custom name to make it easier to remember?
                    </p>
                </div>

                <div class="mb-6">
                    <div class="flex items-center border-2 border-blue-500 rounded-md overflow-hidden bg-white">
                        <span
                            class="pl-3 pr-1 text-gray-500 text-sm font-medium bg-gray-50 h-10 flex items-center border-r border-gray-200">pastecal.com/</span>
                        <input ref="claimInput" type="text" v-model="calendar.id" aria-label="Claim custom URL"
                            class="flex-1 p-2 text-gray-900 font-medium focus:outline-none" placeholder="my-calendar"
                            @keyup.enter="confirmClaim">
                    </div>
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        Examples: <span class="italic">marketing-schedule, trip-2025, soccer-team</span>
                    </p>
                </div>
                <button @click="confirmClaim"
                    class="w-full py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-colors flex items-center justify-center gap-2">
                    <span>Claim URL</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>
                </button>
            </div>
        </div>

        <pre v-text="syncFusionEvents" v-if="debug"></pre>
        <pre v-text="calendar" v-if="debug"></pre>

        <toast-notification ref="toast"></toast-notification>
    </div>

    
    <script src="/nativecal/loader.js"></script>

</body>

</html>
