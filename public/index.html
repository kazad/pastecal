<!DOCTYPE html>
<html lang="en">
<!-- TODO

Other cals: https://demo.mobiscroll.com/javascript/eventcalendar#
 * this looks like a good option. Looks great. Can save a lot of time.

 * Can load from google calendar
https://fullcalendar.io/docs/initialize-globals
pastecal - pastebin for calendars
Other themes: https://igoradamenko.github.io/awsm.css/download.html 

https://dhtmlx.com/docs/products/dhtmlxScheduler/ -- can double click to edit inline

* For pharmacy -- can get the schedule printed out! Neat.
* And have the chores/errands for recycling, etc.

Tell Joey if we make the website: https://github.com/joereynolds/what-to-code#websites

Features: 
Firebase integration - get firebase project
* embed calc 
* hashtags to tag calendar

Coding features:
* DONE: Hook up firebase
* Switch to fullcalendar -- can use google cal as well
* Have events handle all-day
* Use Vue to manage state and URLs
* Make a single page app on firebase hosting
* Have functions to export cal for google calendar etc
* Have an autogen date (YYMMDD.ITEM) so (220103.1) as YOUR calc.
* Or, have a private name (zad if you want)
* Description for calendar (tags, etc)

* Have 10 possible categories. Can rename the categories as you want.
* Get a clean look like this: https://ui.toast.com/tui-calendar
* Have an options view
* Have default timezone (?). How to handle this.

* pastecal.com/#hz

make a calc with the following chars:
* 0-9a-zA-Z underscore and dash. That's it. No dot. No slashes. Just simple items.

pastecal.com
calpaste.com

UI: https://daisyui.com/
tailwindcss


Use cases:

* Visiting homepage, entering ID, creates the calendar with that shortcode
* Visiting homepage, have random shortcode (shortID) prepopulated
* Visiting pastecal.com/ID creates the calendar (prefilled option to create)

-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PasteCal</title>
    <link rel="stylesheet" href="style.css">
    <!--
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
-->
    <!-- CDN Development (always latest) -->
    <link rel="stylesheet" href="https://unpkg.com/style.css">
    <!-- calendar TUI -->
    <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.css" />

    <!-- If you use the default popups, use this. -->
    <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />

    <script src="https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js"></script>
    <script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.min.js"></script>
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.min.js"></script>
    <script src="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.js"></script>

    <script src="https://unpkg.com/vue@next"></script>
    <!-- firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-compat.js"></script>
    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCZ9U1FflAFcdDLgxJscs2BwV_PrXqmzKw",
            authDomain: "pastecal-web.firebaseapp.com",
            databaseURL: "https://pastecal-web-default-rtdb.firebaseio.com",
            projectId: "pastecal-web",
            storageBucket: "pastecal-web.appspot.com",
            messagingSenderId: "912998627577",
            appId: "1:912998627577:web:aa652846c2618a986d8a28",
            measurementId: "G-4J99GY9KE6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log("firebase loaded", firebase);
        const db = firebase.database().ref('/calendars');

        class CalendarDataService {
            static slug = null;

            static getAll() {
                return db;
            }

            // subscribe to live updates
            static subscribe(slug) {
                this.slug = slug;
                if (this.slug) {
                    db.child(this.slug).on('value', data => {
                        console.log("got data from slug");
                        var events = data.val().events;
                        _calstore.events = events;
                        Utils.render();
                    })
                }
            }

            static sync() {
                if (this.slug && _calstore) {
                    this.createWithId(this.slug, _calstore);
                    console.log("data sync");
                }
            }

            static create(item) {
                return db.push(item);
            }

            static createWithId(key, value) {
                return db.child(key).set(value);
            }

            static update(key, value) {
                return db.child(key).update(value);
            }

            static delete(key) {
                return db.child(key).remove();
            }
        }
    </script>
    <script src="index.js"></script>
</head>

<body>
    <h1>WebCal</h1>
    <p>One click makes a shared, editable calendar. No signups.</p>
    <style>
        body {
            max-width: 95%;
            margin: 0px auto;
        }

        #app input#slug {
            width: 200px;
        }
    </style>
    <div id="app">
        https://pastecal.com/<input id="slug" readonly type="text" v-model="slug"></input>
        <button @click="create">Create</button>

        <button @click="month">Month</button>
        <button @click="week">Week</button>
        <button @click="day">Day</button>

        <!-- <button @click="clearAll">Clear everything</button> -->
    </div>
    <div id="calendar" style="width: 95%; height: 600px; border: 1px solid #ccc;">
    </div>
    <script>
        const CalendarVueApp = {
            data() {
                console.log("Vue: data()");
                var urlslug = window.location.pathname.split("/")[1];
                var random = nanoid(6);
                var slug = urlslug ?? random;
                CalendarDataService.subscribe(slug);

                return {
                    message: 'Cal stuff here',
                    slug: slug
                }
            },

            setup() {
                console.log("Vue:setup()");
                window.calendar = new tui.Calendar('#calendar', {
                    defaultView: 'week',
                    taskView: false,
                    useCreationPopup: true,
                    useDetailPopup: true,
                });

                CalendarDataService.subscribe();
                Utils.init();
                Utils.render();
            },

            methods: {
                create() {
                    events = Utils.getEvents();
                    console.log(this.slug, _calstore);
                    CalendarDataService.createWithId(this.slug, _calstore);
                },

                clearAll() {
                    Utils.clearEvents();
                    Utils.render();
                    console.log('clear');
                }
            }
        };

        Vue.createApp(CalendarVueApp).mount('#app');
    </script>

    <script>
    </script>
    <div></div>
    <br />
    <p>
        Features:
    <ul>
        <li>Simple calendar UX</li>
        <li>Share with anyone with a link</li>
        <li>Daily revision history for changes</li>
        <!-- <li>Add calendar with iCal subscription</li> -->
        <li>No-login to embed your calendar in any page</li>
    </ul>
    </p>

</body>

</html>